name: Deploy MkDocs Documentation

on:
  push:
    path: 'documentation/**'
    branches:
      - 143-documentation-deployment

jobs:
  deploy_docs:
    runs-on: ubuntu-latest
    env:
      working-directory: ./

    permissions:
      contents: write
      pull-requests: write
      actions: write

    steps:
    - name: Checkout UInnovate repository
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        pip install mkdocs

    - name: Copy .md files from usecase to root documentation
      run: |
        cp database/useCaseOne/*.md ./documentation

    - name: Build MkDocs documentation
      working-directory: ./documentation
      run: |
        mkdocs build -d documentation

    - name: Copy files to another repository
      uses: nkoppel/push-files-to-another-repository@v1.1.2      
      env:
        API_TOKEN_GITHUB: ${{ secrets.POSTGOAT_WEBSITE_REPOSITORY_DEPLOYMENT_SECRET }}
      with:
        source-files: 'documentation'
        destination-username: 'MariaR001'
        destination-repository: 'PostGOAT'
        destination-branch: 'main'
        commit-email: 'ma_iv@live.concordia.ca'

    - name: Configure Git
      run: |
        git config --global user.email "actions@github.com"
        git config --global user.name "GitHub Actions"

    - name: Commit and push changes to PostGOAT repository
      run: |
        cd PostGOAT
        git init
        git add .
        git commit -m "Update documentation files"
        git push --force https://${{ secrets.POSTGOAT_GITHUB_TOKEN }}@github.com/MariaR001/PostGOAT.git master:main
